<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Analysis Result | Nexus CV</title>
    <meta name="description"
        content="Your AI-generated resume analysis: ATS score, skill gaps, career roadmap, and improvement suggestions.">
    <meta property="og:title" content="Resume Analysis | Nexus CV">
    <meta property="og:description" content="AI-powered ATS score breakdown and career guidance.">
    <meta property="og:image" content="/static/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="canonical" href="/result">
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/static/style.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <script src="/static/theme.js"></script>
    <nav class="navbar">
        <button onclick="toggleTheme()" class="btn outline">ðŸŒ™</button>
        <div class="brand">
            <img src="{{ url_for('static', filename='nexuscv-logo.svg') }}" class="brand-logo" alt="Nexus CV">
            <span class="brand-text">Nexus CV</span>
        </div>

        {% if session.get("user") %}
        <div class="profile">
            <div class="avatar" onclick="toggleMenu()">
                {{ session["user"][0]|upper }}
            </div>

            <div id="menu" class="menu">
                <a href="/history">History</a>
                <a href="/upload-page">Upload Resume</a>
                <a href="/compare-resume">Compare Resumes</a>
                <a href="/resume-builder">Build Resume</a>
                <a href="/download-pdf">Download Report</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
        {% else %}
        <div>
            <a href="/login" class="btn outline">Login</a>
            <a href="/register" class="btn">Register</a>
        </div>
        {% endif %}
    </nav>


    <div class="container">

        {% if validation_summary %}
        <div class="validation-summary">
            <div class="vs-item">
                <span class="vs-check">âœ”</span> Resume structure detected
            </div>
            <div class="vs-item">
                <span class="vs-check">âœ”</span> Sections found: {{ validation_summary.sections_found | join(", ") }}
            </div>
            {% if validation_summary.jd_detected %}
            <div class="vs-item">
                <span class="vs-check">âœ”</span> Job description validated
            </div>
            {% endif %}
            <div class="vs-item">
                <span class="vs-check">âœ”</span> Content quality score: {{ validation_summary.quality_score }}%
            </div>
        </div>
        {% endif %}

        <h1>Resume Analysis Dashboard</h1>

        <!-- ROLE -->
        <section class="card">
            <h3>Best Matching Roles</h3>

            {% for r in roles %}
            <div class="role-item {% if r.score == 100 %}active{% endif %}">
                <div>
                    <strong>{{ r.role }}</strong><br>
                    <small style="opacity: 0.75;">{{ r.reason }}</small>
                </div>
                <span>{{ r.score }}%</span>
            </div>

            {% endfor %}
        </section>


        <!-- ATS SCORE -->
        <section class="card">
            <h3>ATS Score</h3>

            <div class="chart-wrapper">
                <div class="chart-center">
                    <span id="atsValue" class="score">0%</span>

                </div>
                <canvas id="atsChart" data-score="{{ ats_score }}"></canvas>
            </div>
            <div id="atsLabel" class="confidence-below">Good Â· Above average</div>

            <div class="progress">
                <div class="progress-bar" data-score="{{ ats_score }}"></div>
            </div>
        </section>

        <section class="card">
            <h3>ATS Score Breakdown</h3>

            <p>âœ” <b>Skills Match:</b> {{ ats_breakdown.skill }} / 50</p>
            <p>âœ” <b>Keyword Coverage:</b> {{ ats_breakdown.keyword }} / 30</p>
            <p>âœ” <b>Resume Completeness:</b> {{ ats_breakdown.completeness }} / 20</p>
        </section>

        <!-- JOB DESCRIPTION MATCH -->
        <section class="card">
            <h3>Job Description Match (Role-Specific)</h3>

            <p><b>Match Percentage:</b> {{ jd_result.match_percentage }}%</p>

            <p><b>Matched Skills:</b></p>
            {% for s in jd_result.matched_skills %}
            <span class="tag green">{{ s }}</span>
            {% endfor %}

            <p><b>Missing for this Job Role:</b></p>

            {% if jd_result.grouped_missing %}
            {% for group, words in jd_result.grouped_missing.items() %}
            <p><strong>{{ group }}:</strong></p>
            {% for w in words %}
            <span class="tag red">{{ w }}</span>
            {% endfor %}
            {% endfor %}
            {% else %}
            <p>No major missing keywords detected.</p>
            {% endif %}
        </section>


        <!-- RESUME INSIGHTS -->
        <section class="card">
            <h3>Resume Insights</h3>

            <p><b>Length Analysis:</b> {{ insights.length }}</p>
            <p><b>Skill Density:</b> {{ insights.skill_density }}</p>
            <p><b>Overall Strength:</b> {{ insights.strength }}</p>

            {% if insights.missing_sections %}
            <p><b>Missing Sections:</b></p>
            {% for sec in insights.missing_sections %}
            <span class="tag red">{{ sec }}</span>
            {% endfor %}
            {% else %}
            <p><b>All important sections present âœ”</b></p>
            {% endif %}
        </section>


        <!-- AI SUGGESTIONS -->
        <section class="card highlight">
            <h3>AI Resume Improvement Suggestions</h3>

            <ul class="suggestions">
                {% for s in suggestions %}
                <li>âœ¨ {{ s }}</li>
                {% endfor %}
            </ul>
        </section>


        <!-- SKILLS -->
        <section class="card">
            <h3>Skills Analysis</h3>

            <h4>Matched Skills</h4>
            {% for skill in matched_skills %}
            <div class="skill">
                <span>{{ skill }}</span>
                <div class="bar good"></div>
            </div>
            {% endfor %}

            <h4>Missing Skills (Overall Resume)</h4>

            {% if missing_classified.critical or missing_classified.optional %}

            {% if missing_classified.critical %}
            <p><strong>Critical:</strong></p>
            {% for skill in missing_classified.critical %}
            <div class="skill">
                <span>{{ skill }}</span>
                <div class="bar bad"></div>
            </div>
            {% endfor %}
            {% endif %}

            {% if missing_classified.optional %}
            <p><strong>Optional:</strong></p>
            {% for skill in missing_classified.optional %}
            <div class="skill">
                <span>{{ skill }}</span>
                <div class="bar bad"></div>
            </div>
            {% endfor %}
            {% endif %}

            {% else %}
            <p style="opacity:0.7;">No missing skills in your resume overall âœ”</p>
            {% endif %}

        </section>


        <!-- ROADMAP -->
        <section class="card">
            <h3>Career Roadmap</h3>

            {% if roadmap %}
            <ul class="roadmap">
                {% for month, plan in roadmap.items() %}
                <li>
                    <strong>{{ month }}</strong>
                    <p>{{ plan }}</p>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p>Your resume already meets the basic requirements ðŸŽ‰</p>
            {% endif %}
        </section>


        <!-- ACTIONS -->
        <div style="text-align:center; margin-top:30px;">
            <a href="/download-pdf" class="btn">Download PDF Report</a>
            <a href="/upload-page" class="btn">Analyze Another Resume</a>
            <a href="/logout" class="btn outline">Logout</a>
        </div>


    </div>

    <!-- ===================== -->
    <!-- JAVASCRIPT SECTION -->
    <!-- ===================== -->

    <!-- JS -->
    <script>
        const canvas = document.getElementById("atsChart");
        const finalScore = parseInt(canvas.dataset.score);

        const scoreEl = document.getElementById("atsValue");
        const labelEl = document.getElementById("atsLabel");
        const compareEl = document.getElementById("atsCompare");


        /* ---------- COUNT-UP ANIMATION ---------- */
        let current = 0;
        const counter = setInterval(() => {
            current++;
            scoreEl.textContent = current + "%";
            if (current >= finalScore) clearInterval(counter);
        }, 15);

        /* ---------- CONFIDENCE LABEL ---------- */
        if (finalScore >= 80) {
            atsLabel.textContent = "Excellent Â· Top tier";
        }
        else if (finalScore >= 60) {
            atsLabel.textContent = "Good Â· Above average";
        }
        else {
            atsLabel.textContent = "Needs work Â· Below average";
        }


        /* ---------- DONUT CHART ---------- */
        new Chart(canvas, {
            type: "doughnut",
            data: {
                datasets: [{
                    data: [finalScore, 100 - finalScore],
                    backgroundColor: ["#14b8a6", "#a5b4fc"],
                    borderWidth: 0
                }]
            },
            options: {
                cutout: "72%",
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                }
            }
        });

        /* ---------- PROGRESS BAR ---------- */
        window.onload = () => {
            document.querySelector(".progress-bar").style.width = finalScore + "%";
        };

        /* ---------- CARD STAGGER ANIMATION ---------- */
        document.querySelectorAll(".card").forEach((card, i) => {
            card.style.animationDelay = `${i * 0.1}s`;
        });
    </script>

</body>

</html>