<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Comparison Result | ResumeIQ</title>
    <meta name="description"
        content="See how your updated resume compares: ATS score changes, skills added and removed, and AI analysis.">
    <meta property="og:title" content="Comparison Result | ResumeIQ">
    <meta property="og:description" content="AI-driven resume comparison with ATS scoring.">
    <meta property="og:image" content="/static/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="canonical" href="/compare-result">
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <script src="/static/theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <nav class="navbar">
        <button onclick="toggleTheme()" class="btn outline">ðŸŒ™</button>
        <div></div>
        {% if session.get("user") %}
        <div class="profile">
            <div class="avatar" onclick="toggleMenu()">
                {{ session["user"][0]|upper }}
            </div>
            <div id="menu" class="menu">
                <a href="/">Home</a>
                <a href="/history">History</a>
                <a href="/upload-page">Upload Resume</a>
                <a href="/compare-resume">Compare Resumes</a>
                <a href="/resume-builder">Build Resume</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
        {% else %}
        <div>
            <a href="/login" class="btn outline">Login</a>
            <a href="/register" class="btn">Register</a>
        </div>
        {% endif %}
    </nav>

    <div class="container">

        <section class="card">
            <h3>Resume Improvement Summary</h3>

            <p><b>Target Role:</b> {{ comparison.role }}</p>

            <p>
                <b>ATS Score:</b>
                {{ comparison.ats_before }} â†’ {{ comparison.ats_after }}

                {% if comparison.ats_change > 0 %}
                <span style="color:#22c55e;font-weight:600;">â†‘ +{{ comparison.ats_change }}</span>
                {% elif comparison.ats_change < 0 %} <span style="color:#ef4444;font-weight:600;">â†“ {{
                    comparison.ats_change }}</span>
                    {% else %}
                    <span style="opacity:0.6;">â†’ No change</span>
                    {% endif %}
            </p>

        </section>

        <section class="card">
            <h3>ATS Score Comparison</h3>
            <canvas id="atsCompareChart" data-old="{{ comparison.ats_before }}" data-new="{{ comparison.ats_after }}"
                height="180"></canvas>
        </section>

        {% if comparison.skills_added %}
        <section class="card">
            <h3>Skills Added</h3>
            <div>
                {% for skill in comparison.skills_added %}
                <span class="skill-tag skill-matched">+ {{ skill }}</span>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        {% if comparison.skills_removed %}
        <section class="card">
            <h3>Skills Removed</h3>
            <div>
                {% for skill in comparison.skills_removed %}
                <span class="skill-tag skill-missing">âˆ’ {{ skill }}</span>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        {% if comparison.jd_before and comparison.jd_after %}
        <section class="card">
            <h3>Job Description Match</h3>
            <p><b>Before:</b> {{ comparison.jd_before.match_percentage }}%</p>
            <p><b>After:</b> {{ comparison.jd_after.match_percentage }}%</p>
        </section>
        {% endif %}

        <!-- AI Insight â€” Dynamic, data-driven -->
        <section class="card highlight">
            <h3>AI Analysis</h3>
            {% if comparison.ai_summary %}
            <p>{{ comparison.ai_summary }}</p>
            {% else %}
            {% if comparison.ats_change > 0 %}
            <p>The updated resume demonstrates improved alignment with the <b>{{ comparison.role }}</b> role
                requirements, reflecting stronger keyword coverage and domain-relevant skill inclusion.</p>
            {% elif comparison.ats_change < 0 %} <p>The updated resume shows reduced alignment with the <b>{{
                    comparison.role }}</b> role, possibly due to removal of key skills or reduced keyword relevance.</p>
                {% else %}
                <p>Both resume versions demonstrate similar alignment with the <b>{{ comparison.role }}</b> role
                    requirements.</p>
                {% endif %}
                {% endif %}
        </section>

        <div style="text-align:center;">
            <a href="/download-compare-report" class="btn large">Download Comparison Report</a>
            <a href="/compare-resume" class="btn">Analyze Again</a>
            <a href="/history" class="btn outline">View History</a>
        </div>

    </div>

    <script>
        const canvas = document.getElementById("atsCompareChart");
        const oldScore = parseInt(canvas.dataset.old);
        const newScore = parseInt(canvas.dataset.new);
        const isDark = document.body.classList.contains("dark");

        new Chart(canvas, {
            type: "bar",
            data: {
                labels: ["Resume V1 (Old)", "Resume V2 (New)"],
                datasets: [{
                    label: "ATS Score",
                    data: [oldScore, newScore],
                    backgroundColor: [
                        "rgba(251, 146, 60, 0.85)",
                        "rgba(99, 102, 241, 0.85)"
                    ],
                    borderColor: [
                        "rgba(251, 146, 60, 1)",
                        "rgba(99, 102, 241, 1)"
                    ],
                    borderWidth: 2,
                    borderRadius: 12,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                animation: {
                    duration: 1400,
                    easing: "easeOutQuart"
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: isDark ? "#1e293b" : "#ffffff",
                        titleColor: isDark ? "#f1f5f9" : "#0f172a",
                        bodyColor: isDark ? "#cbd5e1" : "#334155",
                        borderColor: isDark ? "rgba(99,102,241,0.3)" : "rgba(0,0,0,0.1)",
                        borderWidth: 1,
                        cornerRadius: 10,
                        padding: 12
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: {
                            color: isDark ? "rgba(255,255,255,0.06)" : "rgba(0,0,0,0.06)",
                            drawBorder: false
                        },
                        ticks: {
                            color: isDark ? "#94a3b8" : "#64748b",
                            font: { family: "'Inter', sans-serif", weight: 500 }
                        }
                    },
                    x: {
                        grid: { display: false },
                        ticks: {
                            color: isDark ? "#94a3b8" : "#64748b",
                            font: { family: "'Inter', sans-serif", weight: 600, size: 13 }
                        }
                    }
                }
            }
        });
    </script>

</body>

</html>